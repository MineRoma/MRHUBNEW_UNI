local service = "16451";
local secret = "3fd9b8c7-1f40-41e6-afb7-b5d98a48d6e7";
local useNonce = true

-- =========================================================================
-- EXECUTOR DETECTION
-- =========================================================================
local ExecutorSupport = {
    name = "Unknown",
    request = nil,
    clipboard = nil,
    hwid = nil,
    writefile = nil,
    readfile = nil,
    isfile = nil,
    guiParent = nil
}

local function detectExecutor()
    -- Detect executor name
    if identifyexecutor then
        local success, result = pcall(identifyexecutor)
        if success then
            ExecutorSupport.name = result
        end
    elseif getexecutorname then
        local success, result = pcall(getexecutorname)
        if success then
            ExecutorSupport.name = result
        end
    end
    
    -- Specific executor detection
    if ExecutorSupport.name == "Unknown" then
        if syn and syn.request then
            ExecutorSupport.name = "Synapse X"
        elseif KRNL_LOADED then
            ExecutorSupport.name = "KRNL"
        elseif fluxus and fluxus.request then
            ExecutorSupport.name = "Fluxus"
        elseif getgenv().Xeno then
            ExecutorSupport.name = "Xeno"
        elseif SENTINEL_LOADED then
            ExecutorSupport.name = "Sentinel"
        elseif getgenv().ScriptWare then
            ExecutorSupport.name = "Script-Ware"
        elseif getgenv().Valyse then
            ExecutorSupport.name = "Valyse"
        elseif getgenv().Celery then
            ExecutorSupport.name = "Celery"
        elseif getgenv().Arceus then
            ExecutorSupport.name = "Arceus X"
        elseif getgenv().Codex then
            ExecutorSupport.name = "Codex"
        elseif getgenv().evon then
            ExecutorSupport.name = "Evon"
        elseif getgenv().Hydrogen then
            ExecutorSupport.name = "Hydrogen"
        elseif getgenv().Comet then
            ExecutorSupport.name = "Comet"
        end
    end
    
    -- Request function (order matters - most reliable first)
    if syn and syn.request then
        ExecutorSupport.request = syn.request
    elseif fluxus and fluxus.request then
        ExecutorSupport.request = fluxus.request
    elseif getgenv().Xeno and getgenv().Xeno.request then
        ExecutorSupport.request = getgenv().Xeno.request
    elseif http and http.request then
        ExecutorSupport.request = http.request
    elseif request then
        ExecutorSupport.request = request
    elseif http_request then
        ExecutorSupport.request = http_request
    elseif HttpPost and HttpGet then
        -- Fallback for some executors
        ExecutorSupport.request = function(data)
            if data.Method == "GET" then
                local body = HttpGet(data.Url)
                return {StatusCode = 200, Body = body}
            elseif data.Method == "POST" then
                local body = HttpPost(data.Url, data.Body)
                return {StatusCode = 200, Body = body}
            end
        end
    end
    
    -- Clipboard function
    if setclipboard then
        ExecutorSupport.clipboard = setclipboard
    elseif toclipboard then
        ExecutorSupport.clipboard = toclipboard
    elseif syn and syn.write_clipboard then
        ExecutorSupport.clipboard = syn.write_clipboard
    elseif getgenv().Xeno and getgenv().Xeno.setclipboard then
        ExecutorSupport.clipboard = getgenv().Xeno.setclipboard
    elseif Clipboard and Clipboard.set then
        ExecutorSupport.clipboard = Clipboard.set
    end
    
    -- HWID function
    if gethwid then
        ExecutorSupport.hwid = gethwid
    elseif getdeviceid then
        ExecutorSupport.hwid = getdeviceid
    elseif getandroidid then
        ExecutorSupport.hwid = getandroidid
    elseif syn and syn.hw_id then
        ExecutorSupport.hwid = function() return syn.hw_id end
    elseif getgenv().Xeno and getgenv().Xeno.getDeviceId then
        ExecutorSupport.hwid = getgenv().Xeno.getDeviceId
    elseif identifyexecutor and game:GetService("RbxAnalyticsService") then
        ExecutorSupport.hwid = function()
            local success, result = pcall(function()
                return game:GetService("RbxAnalyticsService"):GetClientId()
            end)
            if success and result then
                return result
            end
            return tostring(game:GetService("Players").LocalPlayer.UserId)
        end
    else
        ExecutorSupport.hwid = function()
            return tostring(game:GetService("Players").LocalPlayer.UserId)
        end
    end
    
    -- File functions
    if writefile then
        ExecutorSupport.writefile = writefile
    elseif getgenv().Xeno and getgenv().Xeno.writefile then
        ExecutorSupport.writefile = getgenv().Xeno.writefile
    end
    
    if readfile then
        ExecutorSupport.readfile = readfile
    elseif getgenv().Xeno and getgenv().Xeno.readfile then
        ExecutorSupport.readfile = getgenv().Xeno.readfile
    end
    
    if isfile then
        ExecutorSupport.isfile = isfile
    elseif getgenv().Xeno and getgenv().Xeno.isfile then
        ExecutorSupport.isfile = getgenv().Xeno.isfile
    end
    
    -- GUI Parent
    local CoreGui = game:GetService("CoreGui")
    local PlayerGui = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    
    if syn and syn.protect_gui then
        ExecutorSupport.guiParent = CoreGui
        ExecutorSupport.protectGui = syn.protect_gui
    elseif gethui then
        local success, result = pcall(gethui)
        if success and result then
            ExecutorSupport.guiParent = result
        else
            ExecutorSupport.guiParent = CoreGui
        end
    else
        local success = pcall(function()
            local test = Instance.new("ScreenGui")
            test.Parent = CoreGui
            test:Destroy()
        end)
        
        if success then
            ExecutorSupport.guiParent = CoreGui
        else
            ExecutorSupport.guiParent = PlayerGui
        end
    end
    
    return ExecutorSupport
end

local Executor = detectExecutor()

-- =========================================================================
-- SAFE WRAPPER FUNCTIONS
-- =========================================================================
local function safeRequest(options)
    if not Executor.request then
        warn("[MR HUB] No request function available!")
        return nil
    end
    
    local success, result = pcall(function()
        return Executor.request(options)
    end)
    
    if success then
        return result
    else
        warn("[MR HUB] Request failed: " .. tostring(result))
        return nil
    end
end

local function safeClipboard(text)
    if Executor.clipboard then
        local success, err = pcall(function()
            Executor.clipboard(text)
        end)
        return success
    end
    return false
end

local function safeGetHwid()
    local success, result = pcall(function()
        return Executor.hwid()
    end)
    if success and result then
        return tostring(result)
    end
    return tostring(game:GetService("Players").LocalPlayer.UserId)
end

local function safeWriteFile(name, content)
    if Executor.writefile then
        local success, err = pcall(function()
            Executor.writefile(name, content)
        end)
        return success
    end
    return false
end

local function safeReadFile(name)
    if Executor.isfile and Executor.readfile then
        local exists = false
        pcall(function()
            exists = Executor.isfile(name)
        end)
        if exists then
            local success, content = pcall(function()
                return Executor.readfile(name)
            end)
            if success then
                return content
            end
        end
    end
    return nil
end

-- =========================================================================
-- WAIT FOR GAME
-- =========================================================================
if not game:IsLoaded() then
    game.Loaded:Wait()
end
task.wait(0.5)

-- =========================================================================
-- SERVICES
-- =========================================================================
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- =========================================================================
-- VARIABLES
-- =========================================================================
local requestSending = false
local cachedLink, cachedTime = "", 0
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- Key file
local KEY_FILE = "MRHub_Key.mrhk"

-- =========================================================================
-- KEY ENCRYPTION
-- =========================================================================
local function encodeKey(key)
    if not key or key == "" then return "" end
    local encoded = ""
    local salt = "MRHUB_SALT_2024"
    for i = 1, #key do
        local keyByte = string.byte(key, i)
        local saltByte = string.byte(salt, ((i - 1) % #salt) + 1)
        local newByte = (keyByte + saltByte + i * 3) % 256
        encoded = encoded .. string.format("%02X", newByte)
    end
    return "MRHK_V1_" .. encoded .. "_" .. tostring(#key)
end

local function decodeKey(encoded)
    if not encoded or type(encoded) ~= "string" or encoded == "" then
        return nil
    end
    if not string.match(encoded, "^MRHK_V1_") then
        return nil
    end
    
    local hexData, lenStr = string.match(encoded, "^MRHK_V1_(.+)_(%d+)$")
    if not hexData or not lenStr then
        return nil
    end
    
    local expectedLen = tonumber(lenStr)
    if not expectedLen or expectedLen <= 0 then
        return nil
    end
    
    local salt = "MRHUB_SALT_2024"
    local decoded = ""
    
    for i = 1, expectedLen do
        local startIdx = (i - 1) * 2 + 1
        local endIdx = i * 2
        local hex = string.sub(hexData, startIdx, endIdx)
        
        if #hex ~= 2 then
            return nil
        end
        
        local byte = tonumber(hex, 16)
        if not byte then
            return nil
        end
        
        local saltByte = string.byte(salt, ((i - 1) % #salt) + 1)
        local originalByte = (byte - saltByte - i * 3) % 256
        decoded = decoded .. string.char(originalByte)
    end
    
    return decoded
end

local function saveKey(key)
    if not key or key == "" then return false end
    return safeWriteFile(KEY_FILE, encodeKey(key))
end

local function loadKey()
    local encoded = safeReadFile(KEY_FILE)
    if encoded and encoded ~= "" then
        return decodeKey(encoded)
    end
    return nil
end

-- =========================================================================
-- PLATOBOOST API
-- =========================================================================
local function lDigest(input)
    local inputStr = tostring(input)
    local hashHex = ""
    for i = 1, #inputStr do
        hashHex = hashHex .. string.format("%02x", string.byte(inputStr, i))
    end
    return hashHex
end

local host = "https://api.platoboost.com"

-- Check connectivity
task.spawn(function()
    local response = safeRequest({
        Url = host .. "/public/connectivity",
        Method = "GET"
    })
    if not response or response.StatusCode ~= 200 then
        host = "https://api.platoboost.net"
    end
end)

local function cacheLink()
    if cachedLink ~= "" and cachedTime + 600 > os.time() then
        return true, cachedLink
    end
    
    local hwid = safeGetHwid()
    local identifier = lDigest(hwid)
    
    local response = safeRequest({
        Url = host .. "/public/start",
        Method = "POST",
        Body = HttpService:JSONEncode({
            service = service,
            identifier = identifier
        }),
        Headers = {
            ["Content-Type"] = "application/json"
        }
    })

    if not response then
        return false, "Request failed - check executor"
    end
    
    if response.StatusCode == 200 then
        local success, decoded = pcall(function()
            return HttpService:JSONDecode(response.Body)
        end)
        
        if success and decoded then
            if decoded.success == true and decoded.data and decoded.data.url then
                cachedLink = decoded.data.url
                cachedTime = os.time()
                return true, cachedLink
            elseif decoded.message then
                return false, decoded.message
            end
        end
        return false, "Invalid response"
    elseif response.StatusCode == 429 then
        return false, "Rate limited, wait 20 seconds"
    else
        return false, "Server error: " .. tostring(response.StatusCode)
    end
end

local function generateNonce()
    local chars = "abcdefghijklmnopqrstuvwxyz"
    local str = ""
    math.randomseed(os.time() + math.random(1, 99999))
    for _ = 1, 16 do
        local idx = math.random(1, #chars)
        str = str .. string.sub(chars, idx, idx)
    end
    return str
end

local function copyLink()
    local success, link = cacheLink()
    if success and link then
        local clipSuccess = safeClipboard(link)
        return clipSuccess or success, link
    end
    return false, link
end

local function verifyKey(key)
    if requestSending then
        return false, "Please wait..."
    end
    
    if not key or key == "" then
        return false, "No key provided"
    end
    
    requestSending = true

    local hwid = safeGetHwid()
    local identifier = lDigest(hwid)
    local endpoint = host .. "/public/whitelist/" .. tostring(service) .. "?identifier=" .. identifier .. "&key=" .. key

    if useNonce then
        endpoint = endpoint .. "&nonce=" .. generateNonce()
    end

    local response = safeRequest({
        Url = endpoint,
        Method = "GET"
    })

    requestSending = false

    if not response then
        return false, "Request failed"
    end
    
    if response.StatusCode == 200 then
        local success, decoded = pcall(function()
            return HttpService:JSONDecode(response.Body)
        end)
        
        if success and decoded then
            if decoded.success == true and decoded.data then
                if decoded.data.valid == true then
                    return true, "Key verified!"
                else
                    return false, "Invalid or expired key"
                end
            elseif decoded.message then
                return false, decoded.message
            end
        end
        return false, "Invalid response"
    elseif response.StatusCode == 429 then
        return false, "Rate limited, wait 20 seconds"
    else
        return false, "Server error: " .. tostring(response.StatusCode)
    end
end

-- =========================================================================
-- GUI CREATION
-- =========================================================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MRHubKeySystem_" .. math.random(100000, 999999)
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 999999
ScreenGui.IgnoreGuiInset = true

-- Protect and parent GUI
if Executor.protectGui then
    Executor.protectGui(ScreenGui)
end
ScreenGui.Parent = Executor.guiParent

-- =========================================================================
-- NOTIFICATION SYSTEM
-- =========================================================================
local NotifContainer = Instance.new("Frame")
NotifContainer.Name = "NotifContainer"
NotifContainer.Parent = ScreenGui
NotifContainer.BackgroundTransparency = 1
NotifContainer.Position = UDim2.new(1, -10, 1, -10)
NotifContainer.Size = UDim2.new(0, 320, 0, 400)
NotifContainer.AnchorPoint = Vector2.new(1, 1)

local NotifLayout = Instance.new("UIListLayout")
NotifLayout.Parent = NotifContainer
NotifLayout.SortOrder = Enum.SortOrder.LayoutOrder
NotifLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
NotifLayout.Padding = UDim.new(0, 8)

local notifWidth = isMobile and 250 or 300
local notifHeight = isMobile and 60 or 70
local notifCount = 0

local function showNotification(title, text, color, duration)
    duration = duration or 3
    color = color or Color3.fromRGB(161, 46, 255)
    notifCount = notifCount + 1
    local currentOrder = notifCount
    
    local NotifFrame = Instance.new("Frame")
    NotifFrame.Name = "Notif_" .. currentOrder
    NotifFrame.Parent = NotifContainer
    NotifFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    NotifFrame.BackgroundTransparency = 0.05
    NotifFrame.BorderSizePixel = 0
    NotifFrame.Size = UDim2.new(0, notifWidth, 0, notifHeight)
    NotifFrame.Position = UDim2.new(0, notifWidth + 60, 0, 0)
    NotifFrame.LayoutOrder = -currentOrder
    NotifFrame.ClipsDescendants = true
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 10)
    Corner.Parent = NotifFrame
    
    local Stroke = Instance.new("UIStroke")
    Stroke.Color = color
    Stroke.Thickness = 2
    Stroke.Transparency = 0.3
    Stroke.Parent = NotifFrame
    
    local Bar = Instance.new("Frame")
    Bar.Parent = NotifFrame
    Bar.BackgroundColor3 = color
    Bar.BorderSizePixel = 0
    Bar.Position = UDim2.new(0, 0, 0, 0)
    Bar.Size = UDim2.new(0, 4, 1, 0)
    
    local BarCorner = Instance.new("UICorner")
    BarCorner.CornerRadius = UDim.new(0, 2)
    BarCorner.Parent = Bar
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Parent = NotifFrame
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Position = UDim2.new(0, 12, 0, 8)
    TitleLabel.Size = UDim2.new(1, -20, 0, 20)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextSize = isMobile and 14 or 16
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.TextTruncate = Enum.TextTruncate.AtEnd
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.Parent = NotifFrame
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 12, 0, 30)
    TextLabel.Size = UDim2.new(1, -20, 0, 32)
    TextLabel.Font = Enum.Font.Gotham
    TextLabel.Text = text
    TextLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    TextLabel.TextSize = isMobile and 11 or 13
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextWrapped = true
    TextLabel.TextYAlignment = Enum.TextYAlignment.Top
    TextLabel.TextTruncate = Enum.TextTruncate.AtEnd
    
    -- Animate in (right to left)
    local tweenIn = TweenService:Create(NotifFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
        Position = UDim2.new(0, 0, 0, 0)
    })
    tweenIn:Play()
    
    -- Animate out after duration
    task.delay(duration, function()
        if NotifFrame and NotifFrame.Parent then
            local tweenOut = TweenService:Create(NotifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {
                Position = UDim2.new(0, notifWidth + 60, 0, 0)
            })
            tweenOut:Play()
            tweenOut.Completed:Connect(function()
                if NotifFrame and NotifFrame.Parent then
                    NotifFrame:Destroy()
                end
            end)
        end
    end)
end

-- =========================================================================
-- MAIN UI
-- =========================================================================
local containerWidth = isMobile and 320 or 400
local containerHeight = isMobile and 290 or 330
local buttonHeight = isMobile and 45 or 52
local buttonWidth = isMobile and 280 or 340
local textSize = isMobile and 15 or 18
local titleSize = isMobile and 13 or 16

local MainContainer = Instance.new("Frame")
MainContainer.Name = "MainContainer"
MainContainer.Parent = ScreenGui
MainContainer.BackgroundTransparency = 1
MainContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
MainContainer.Size = UDim2.new(0, containerWidth, 0, containerHeight)
MainContainer.AnchorPoint = Vector2.new(0.5, 0.5)

-- =========================================================================
-- DRAGGING SYSTEM
-- =========================================================================
local dragging = false
local dragStart = nil
local startPos = nil

local function updateDrag(input)
    if not dragging or not dragStart or not startPos then
        return
    end
    local delta = input.Position - dragStart
    local newPos = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
    MainContainer.Position = newPos
end

-- =========================================================================
-- HEADER
-- =========================================================================
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainContainer
Header.BackgroundColor3 = Color3.fromRGB(85, 24, 134)
Header.BorderSizePixel = 0
Header.Position = UDim2.new(0, 0, 0, 0)
Header.Size = UDim2.new(1, 0, 0, 50)

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local HeaderFix = Instance.new("Frame")
HeaderFix.Parent = Header
HeaderFix.BackgroundColor3 = Color3.fromRGB(85, 24, 134)
HeaderFix.BorderSizePixel = 0
HeaderFix.Position = UDim2.new(0, 0, 0.5, 0)
HeaderFix.Size = UDim2.new(1, 0, 0.5, 0)

-- Drag events
Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainContainer.Position
    end
end)

Header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        dragStart = nil
        startPos = nil
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        updateDrag(input)
    end
end)

local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 1, 0)
Title.Font = Enum.Font.LuckiestGuy
Title.Text = "MINEROMA TEAM | KEY SYSTEM"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = titleSize

-- Executor indicator
local ExecutorLabel = Instance.new("TextLabel")
ExecutorLabel.Parent = Header
ExecutorLabel.BackgroundTransparency = 1
ExecutorLabel.Position = UDim2.new(1, -8, 0, 4)
ExecutorLabel.Size = UDim2.new(0, 100, 0, 14)
ExecutorLabel.AnchorPoint = Vector2.new(1, 0)
ExecutorLabel.Font = Enum.Font.Gotham
ExecutorLabel.Text = Executor.name
ExecutorLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
ExecutorLabel.TextSize = 10
ExecutorLabel.TextXAlignment = Enum.TextXAlignment.Right
ExecutorLabel.TextTransparency = 0.3

-- =========================================================================
-- MAIN PANEL
-- =========================================================================
local Main = Instance.new("Frame")
Main.Name = "Main"
Main.Parent = MainContainer
Main.BackgroundColor3 = Color3.fromRGB(35, 18, 55)
Main.BorderSizePixel = 0
Main.Position = UDim2.new(0, 0, 0, 50)
Main.Size = UDim2.new(1, 0, 1, -50)

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = Main

local MainFix = Instance.new("Frame")
MainFix.Parent = Main
MainFix.BackgroundColor3 = Color3.fromRGB(35, 18, 55)
MainFix.BorderSizePixel = 0
MainFix.Size = UDim2.new(1, 0, 0, 14)

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(161, 46, 255)
MainStroke.Thickness = 2
MainStroke.Parent = Main

-- =========================================================================
-- GET KEY BUTTON
-- =========================================================================
local GetKeyBtn = Instance.new("TextButton")
GetKeyBtn.Name = "GetKey"
GetKeyBtn.Parent = Main
GetKeyBtn.BackgroundColor3 = Color3.fromRGB(161, 46, 255)
GetKeyBtn.BorderSizePixel = 0
GetKeyBtn.Position = UDim2.new(0.5, 0, 0, 18)
GetKeyBtn.Size = UDim2.new(0, buttonWidth, 0, buttonHeight)
GetKeyBtn.AnchorPoint = Vector2.new(0.5, 0)
GetKeyBtn.Font = Enum.Font.LuckiestGuy
GetKeyBtn.Text = "GET KEY"
GetKeyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
GetKeyBtn.TextSize = textSize
GetKeyBtn.AutoButtonColor = true

local GetKeyCorner = Instance.new("UICorner")
GetKeyCorner.CornerRadius = UDim.new(0, 10)
GetKeyCorner.Parent = GetKeyBtn

-- =========================================================================
-- KEY INPUT
-- =========================================================================
local TextBox = Instance.new("TextBox")
TextBox.Name = "KeyInput"
TextBox.Parent = Main
TextBox.BackgroundColor3 = Color3.fromRGB(45, 22, 70)
TextBox.BorderSizePixel = 0
TextBox.Position = UDim2.new(0.5, 0, 0, 18 + buttonHeight + 12)
TextBox.Size = UDim2.new(0, buttonWidth, 0, buttonHeight)
TextBox.AnchorPoint = Vector2.new(0.5, 0)
TextBox.Font = Enum.Font.Gotham
TextBox.PlaceholderText = "Enter your key here..."
TextBox.PlaceholderColor3 = Color3.fromRGB(120, 100, 140)
TextBox.Text = ""
TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
TextBox.TextSize = isMobile and 13 or 15
TextBox.ClearTextOnFocus = false
TextBox.ClipsDescendants = true
TextBox.TextTruncate = Enum.TextTruncate.AtEnd

local TextBoxCorner = Instance.new("UICorner")
TextBoxCorner.CornerRadius = UDim.new(0, 10)
TextBoxCorner.Parent = TextBox

local TextBoxStroke = Instance.new("UIStroke")
TextBoxStroke.Color = Color3.fromRGB(100, 60, 140)
TextBoxStroke.Thickness = 1.5
TextBoxStroke.Parent = TextBox

-- Character limit and auto text sizing
local maxChars = 30
local baseTextSize = isMobile and 13 or 15
local minTextSize = isMobile and 9 or 11

TextBox:GetPropertyChangedSignal("Text"):Connect(function()
    local text = TextBox.Text
    
    -- Character limit
    if #text > maxChars then
        TextBox.Text = string.sub(text, 1, maxChars)
        return
    end
    
    -- Auto text size
    local len = #text
    if len > 20 then
        local reduction = (len - 20) * 0.4
        TextBox.TextSize = math.max(minTextSize, baseTextSize - reduction)
    else
        TextBox.TextSize = baseTextSize
    end
end)

-- =========================================================================
-- CHECK KEY BUTTON
-- =========================================================================
local CheckKeyBtn = Instance.new("TextButton")
CheckKeyBtn.Name = "CheckKey"
CheckKeyBtn.Parent = Main
CheckKeyBtn.BackgroundColor3 = Color3.fromRGB(161, 46, 255)
CheckKeyBtn.BorderSizePixel = 0
CheckKeyBtn.Position = UDim2.new(0.5, 0, 0, 18 + buttonHeight + 12 + buttonHeight + 12)
CheckKeyBtn.Size = UDim2.new(0, buttonWidth, 0, buttonHeight)
CheckKeyBtn.AnchorPoint = Vector2.new(0.5, 0)
CheckKeyBtn.Font = Enum.Font.LuckiestGuy
CheckKeyBtn.Text = "CHECK KEY"
CheckKeyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CheckKeyBtn.TextSize = textSize
CheckKeyBtn.AutoButtonColor = true

local CheckKeyCorner = Instance.new("UICorner")
CheckKeyCorner.CornerRadius = UDim.new(0, 10)
CheckKeyCorner.Parent = CheckKeyBtn

-- =========================================================================
-- INFO TEXT
-- =========================================================================
local InfoText = Instance.new("TextLabel")
InfoText.Parent = Main
InfoText.BackgroundTransparency = 1
InfoText.Position = UDim2.new(0.5, 0, 1, -22)
InfoText.Size = UDim2.new(1, -20, 0, 18)
InfoText.AnchorPoint = Vector2.new(0.5, 1)
InfoText.Font = Enum.Font.GothamMedium
InfoText.Text = "t.me/minrteam"
InfoText.TextColor3 = Color3.fromRGB(120, 120, 140)
InfoText.TextSize = isMobile and 11 or 13

-- =========================================================================
-- BUTTON FUNCTIONS
-- =========================================================================
local isProcessing = false

GetKeyBtn.MouseButton1Click:Connect(function()
    if isProcessing then return end
    isProcessing = true
    
    local originalText = GetKeyBtn.Text
    GetKeyBtn.Text = "LOADING..."
    
    task.spawn(function()
        local success, result = copyLink()
        
        if success then
            showNotification("Link Copied!", "Open browser and paste the link", Color3.fromRGB(0, 255, 100), 4)
            GetKeyBtn.Text = "COPIED!"
            task.wait(2)
        else
            showNotification("Error", result or "Failed to get link", Color3.fromRGB(255, 50, 50), 4)
        end
        
        GetKeyBtn.Text = originalText
        isProcessing = false
    end)
end)

CheckKeyBtn.MouseButton1Click:Connect(function()
    if isProcessing then return end
    
    local key = TextBox.Text
    
    if key == "" then
        showNotification("Error", "Please enter a key first!", Color3.fromRGB(255, 50, 50), 3)
        return
    end
    
    isProcessing = true
    local originalText = CheckKeyBtn.Text
    CheckKeyBtn.Text = "CHECKING..."
    
    task.spawn(function()
        local success, message = verifyKey(key)
        
        if success then
            saveKey(key)
            showNotification("Success!", "Key verified! Loading script...", Color3.fromRGB(0, 255, 100), 3)
            CheckKeyBtn.Text = "LOADING..."
            
            task.wait(1.5)
            
            if ScreenGui and ScreenGui.Parent then
                ScreenGui:Destroy()
            end
            
            -- Load main script
            local loadSuccess, loadError = pcall(function()
                loadstring(game:HttpGet('https://raw.githubusercontent.com/MineRoma/MRHUBNEW_UNI/refs/heads/main/nnnft'))()
            end)
            
            if not loadSuccess then
                warn("[MR HUB] Failed to load script: " .. tostring(loadError))
            end
        else
            showNotification("Invalid Key", message, Color3.fromRGB(255, 50, 50), 4)
            CheckKeyBtn.Text = originalText
            isProcessing = false
        end
    end)
end)

-- =========================================================================
-- AUTO CHECK SAVED KEY
-- =========================================================================
task.spawn(function()
    task.wait(1)
    
    local savedKey = loadKey()
    
    if savedKey and savedKey ~= "" then
        showNotification("Checking...", "Verifying saved key", Color3.fromRGB(161, 46, 255), 2)
        
        task.wait(0.5)
        
        local success, message = verifyKey(savedKey)
        
        if success then
            showNotification("Welcome Back!", "Key valid. Loading...", Color3.fromRGB(0, 255, 100), 2)
            
            task.wait(1.5)
            
            if ScreenGui and ScreenGui.Parent then
                ScreenGui:Destroy()
            end
            
            pcall(function()
                loadstring(game:HttpGet('https://raw.githubusercontent.com/MineRoma/MRHUBNEW_UNI/refs/heads/main/nnnft'))()
            end)
        else
            showNotification("Key Expired", "Get a new key!", Color3.fromRGB(255, 150, 0), 4)
            TextBox.Text = savedKey
        end
    else
        showNotification("MR HUB", "Welcome! Get your key to continue.", Color3.fromRGB(161, 46, 255), 4)
    end
end)

-- Debug
print("[MR HUB] Key System loaded!")
print("[MR HUB] Executor: " .. Executor.name)
print("[MR HUB] Request available: " .. tostring(Executor.request ~= nil))
print("[MR HUB] Clipboard available: " .. tostring(Executor.clipboard ~= nil))
print("[MR HUB] File system available: " .. tostring(Executor.writefile ~= nil))
