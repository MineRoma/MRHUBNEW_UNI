local service = "16451";
local secret = "3fd9b8c7-1f40-41e6-afb7-b5d98a48d6e7";

-- =========================================================================
-- EMERGENCY SCRIPT FOR DELTA
-- =========================================================================
repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

-- 1. CLEAN GUI RESET
pcall(function()
    if CoreGui:FindFirstChild("MRHubDebug") then CoreGui.MRHubDebug:Destroy() end
    if Players.LocalPlayer.PlayerGui:FindFirstChild("MRHubDebug") then Players.LocalPlayer.PlayerGui.MRHubDebug:Destroy() end
end)

-- 2. GUI SETUP (SIMPLE & STRONG)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MRHubDebug"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true

-- Пытаемся в PlayerGui (для Delta лучше)
pcall(function() ScreenGui.Parent = Players.LocalPlayer.PlayerGui end)
if not ScreenGui.Parent then ScreenGui.Parent = CoreGui end

local Main = Instance.new("Frame")
Main.Parent = ScreenGui
Main.Size = UDim2.new(0, 300, 0, 350)
Main.Position = UDim2.new(0.5, 0, 0.5, 0)
Main.AnchorPoint = Vector2.new(0.5, 0.5)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Main.BorderSizePixel = 0

local Stroke = Instance.new("UIStroke") Stroke.Parent = Main Stroke.Color = Color3.fromRGB(161, 46, 255) Stroke.Thickness = 2
local Corner = Instance.new("UICorner") Corner.Parent = Main Corner.CornerRadius = UDim.new(0, 8)

-- Console
local Console = Instance.new("ScrollingFrame")
Console.Parent = Main
Console.Size = UDim2.new(0.9, 0, 0.4, 0)
Console.Position = UDim2.new(0.5, 0, 0.95, 0)
Console.AnchorPoint = Vector2.new(0.5, 1)
Console.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Console.ScrollBarThickness = 2

local ConsoleList = Instance.new("UIListLayout") ConsoleList.Parent = Console

local function log(text)
    local L = Instance.new("TextLabel")
    L.Parent = Console
    L.Size = UDim2.new(1, 0, 0, 20)
    L.BackgroundTransparency = 1
    L.TextColor3 = Color3.new(1,1,1)
    L.Text = " > " .. tostring(text)
    L.TextXAlignment = Enum.TextXAlignment.Left
    L.Font = Enum.Font.Code
    L.TextSize = 12
    Console.CanvasPosition = Vector2.new(0, 9999)
end

log("Script loaded.")

-- 3. NETWORK SETUP
local requestFunc = http_request or request or (http and http.request) or (syn and syn.request)

if not requestFunc then log("CRITICAL: No request function!") end

local function getHwid()
    if gethwid then return gethwid()
    elseif getdeviceid then return getdeviceid()
    elseif getandroidid then return getandroidid()
    else return tostring(Players.LocalPlayer.UserId) end
end

local function hash(str)
    local h = ""
    for i = 1, #str do h = h .. string.format("%02x", string.byte(str, i)) end
    return h
end

-- 4. BUTTONS
local function createBtn(text, y, callback)
    local B = Instance.new("TextButton")
    B.Parent = Main
    B.Size = UDim2.new(0.8, 0, 0, 40)
    B.Position = UDim2.new(0.5, 0, 0, y)
    B.AnchorPoint = Vector2.new(0.5, 0)
    B.BackgroundColor3 = Color3.fromRGB(161, 46, 255)
    B.Font = Enum.Font.LuckiestGuy
    B.Text = text
    B.TextColor3 = Color3.new(1,1,1)
    B.TextSize = 16
    local C = Instance.new("UICorner") C.Parent = B C.CornerRadius = UDim.new(0, 6)
    B.MouseButton1Click:Connect(callback)
    return B
end

local Title = Instance.new("TextLabel")
Title.Parent = Main
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.LuckiestGuy
Title.Text = "DEBUG MODE"
Title.TextColor3 = Color3.fromRGB(161, 46, 255)
Title.TextSize = 20

local Input = Instance.new("TextBox")
Input.Parent = Main
Input.Size = UDim2.new(0.8, 0, 0, 35)
Input.Position = UDim2.new(0.5, 0, 0, 110)
Input.AnchorPoint = Vector2.new(0.5, 0)
Input.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Input.Font = Enum.Font.Gotham
Input.Text = ""
Input.PlaceholderText = "Paste Key..."
Input.TextColor3 = Color3.new(1,1,1)
Input.TextSize = 14
local IC = Instance.new("UICorner") IC.Parent = Input IC.CornerRadius = UDim.new(0, 6)

-- 5. LOGIC

-- TEST INTERNET
createBtn("1. TEST NETWORK", 50, function()
    log("Testing Google connection...")
    local s, r = pcall(function()
        return game:HttpGet("https://google.com")
    end)
    if s then
        log("Google: SUCCESS")
    else
        log("Google: FAILED (No Internet?)")
        log(r)
    end
end)

-- GET LINK
createBtn("2. GET KEY LINK", 160, function()
    log("Getting Link...")
    
    local myHwid = getHwid()
    local identifier = hash(myHwid)
    log("HWID: " .. string.sub(identifier, 1, 10).."...")
    
    -- Using .net mirror first, it's often better
    local url = "https://api.platoboost.net/public/start"
    
    local body = HttpService:JSONEncode({
        service = service,
        identifier = identifier
    })
    
    local s, r = pcall(function()
        return requestFunc({
            Url = url,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = body
        })
    end)
    
    if s and r then
        log("Status: " .. tostring(r.StatusCode))
        if r.StatusCode == 200 then
            local data = HttpService:JSONDecode(r.Body)
            if data.success then
                if setclipboard then
                    setclipboard(data.data.url)
                    log("LINK COPIED TO CLIPBOARD!")
                    Input.Text = "LINK COPIED!"
                else
                    Input.Text = data.data.url
                    log("Link in textbox (Manual copy)")
                end
            else
                log("API Error: " .. tostring(data.message))
            end
        else
            log("HTTP Error: " .. tostring(r.StatusCode))
            -- Try fallback to .com
            log("Trying .com domain...")
            -- (Можно добавить повтор запроса на .com тут если хочешь)
        end
    else
        log("Req Failed: " .. tostring(r))
    end
end)

-- CHECK KEY (USING HttpGet)
createBtn("3. VERIFY KEY", 210, function()
    local key = Input.Text
    if #key < 5 then log("Enter key first") return end
    log("Verifying...")
    
    local identifier = hash(getHwid())
    -- Используем game:HttpGet для проверки, это часто обходит DNS баги request-а
    local url = "https://api.platoboost.com/public/whitelist/" .. service .. "?identifier=" .. identifier .. "&key=" .. key
    
    local s, r = pcall(function()
        return game:HttpGet(url)
    end)
    
    if s then
        log("Response received!")
        local data = HttpService:JSONDecode(r)
        if data.success and data.data.valid then
            log("KEY VALID!")
            pcall(function() writefile("MRHub_Key.txt", key) end)
            task.wait(1)
            ScreenGui:Destroy()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/MineRoma/MRHUBNEW_UNI/refs/heads/main/nnnft'))()
        else
            log("Invalid Key")
        end
    else
        log("Verify Failed: " .. tostring(r))
        
        -- Fallback to .net with request
        log("Trying fallback method...")
        local url2 = "https://api.platoboost.net/public/whitelist/" .. service .. "?identifier=" .. identifier .. "&key=" .. key
        local s2, r2 = pcall(function()
            return requestFunc({
                Url = url2,
                Method = "GET"
            })
        end)
        
        if s2 and r2 and r2.StatusCode == 200 then
             local data = HttpService:JSONDecode(r2.Body)
             if data.success and data.data.valid then
                log("VALID (Fallback)!")
                ScreenGui:Destroy()
                loadstring(game:HttpGet('https://raw.githubusercontent.com/MineRoma/MRHUBNEW_UNI/refs/heads/main/nnnft'))()
             end
        else
            log("Fallback failed too.")
        end
    end
end)

-- AUTO LOAD
if isfile and isfile("MRHub_Key.txt") then
    local k = readfile("MRHub_Key.txt")
    if k then Input.Text = k log("Saved key loaded") end
end
